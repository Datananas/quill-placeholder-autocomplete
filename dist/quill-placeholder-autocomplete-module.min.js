!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.QuillPlaceholderAutocomplete=t():e.QuillPlaceholderAutocomplete=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){n(1),e.exports=n(2)},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(3),s=n(4),l=(o=s)&&o.__esModule?o:{default:o};t.default=function(e){var t=e.import("delta");return e.register("formats/suggest",(0,l.default)(e)),function(){function n(e,t){var o=t.onClose,i=t.onOpen,s=t.getPlaceholders,l=t.container;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.quill=e,this.onClose=o,this.onOpen=i,this.getPlaceholders=s,"string"==typeof l?this.container=this.quill.container.parentNode.querySelector(l):void 0===l?(this.container=(0,r.h)("ul",{}),this.quill.container.parentNode.appendChild(this.container)):this.container=l,this.container.classList.add("ql-autocomplete-menu","completions"),this.container.style.position="absolute",this.container.style.display="none",this.onSelectionChange=this.maybeUnfocus.bind(this),this.onTextChange=this.update.bind(this),this.open=!1,this.quill.suggestsDialogOpen=!1,this.hashIndex=null,this.focusedButton=null,this.buttons=[],this.placeholders=[],e.keyboard.addBinding({key:51,altKey:!0},this.onHashKey.bind(this)),e.keyboard.addBinding({key:40,collapsed:!0,format:["suggest"]},this.handleArrow.bind(this)),e.keyboard.addBinding({key:27,collapsed:null,format:["suggest"]},this.handleEscape.bind(this)),e.suggestHandler=this.handleEnterTab.bind(this)}return i(n,[{key:"onHashKey",value:function(t,n){if(this.open)return!0;t.length>0&&this.quill.deleteText(t.index,t.length,e.sources.USER),this.quill.insertText(t.index,"#","suggest","@@placeholder",e.sources.USER);var o=this.quill.getBounds(t.index);this.quill.setSelection(t.index+1,e.sources.SILENT),this.hashIndex=t.index,this.container.style.left=o.left+"px",this.container.style.top=o.top+o.height+"px",this.open=!0,this.quill.suggestsDialogOpen=!0,this.quill.on("text-change",this.onTextChange),this.quill.once("selection-change",this.onSelectionChange),this.update(),this.onOpen&&this.onOpen()}},{key:"handleArrow",value:function(){if(!this.open)return!0;this.buttons[0].focus()}},{key:"handleEnterTab",value:function(){if(!this.open)return!0;this.close(this.placeholders[0])}},{key:"handleEscape",value:function(){if(!this.open)return!0;this.close()}},{key:"emptyCompletionsContainer",value:function(){for(;this.container.firstChild;)this.container.removeChild(this.container.firstChild)}},{key:"update",value:function(){var e=this,t=this.quill.getSelection().index;if(this.hashIndex>=t)return this.close(null);this.originalQuery=this.quill.getText(this.hashIndex+1,t-this.hashIndex-1),this.query=this.originalQuery.toLowerCase(),this.placeholders=this.getPlaceholders().filter(function(t){return t.label.toLowerCase().startsWith(e.query)}).sort(function(e,t){return e.label>t.label}),this.renderCompletions(this.placeholders)}},{key:"maybeUnfocus",value:function(){this.container.querySelector("*:focus")||this.close(null)}},{key:"renderCompletions",value:function(e){var t=this;this.emptyCompletionsContainer();var n=Array(e.length);this.buttons=n;e.forEach(function(e,o){var i,s,l=(0,r.h)("li",{},(0,r.h)("button",{type:"button"},(0,r.h)("span",{className:"matched"},"#"+e.label.slice(0,t.query.length)),(0,r.h)("span",{className:"unmatched"},e.label.slice(t.query.length))));t.container.appendChild(l),n[o]=l.firstChild,n[o].addEventListener("keydown",(i=o,s=e,function(e){"ArrowDown"===e.key||40===e.keyCode?(e.preventDefault(),n[Math.min(n.length-1,i+1)].focus()):"ArrowUp"===e.key||38===e.keyCode?(e.preventDefault(),n[Math.max(0,i-1)].focus()):"Enter"===e.key||13===e.keyCode||" "===e.key||32===e.keyCode||"Tab"===e.key||9===e.keyCode?(e.preventDefault(),t.close(s)):"Escape"!==e.key&&27!==e.keyCode||(e.preventDefault(),t.close())})),n[o].addEventListener("mousedown",function(){return t.close(e)}),n[o].addEventListener("focus",function(){return t.focusedButton=o}),n[o].addEventListener("unfocus",function(){return t.focusedButton=null})}),this.container.style.display="block"}},{key:"close",value:function(n){this.container.style.display="none",this.emptyCompletionsContainer(),this.quill.off("selection-change",this.onSelectionChange),this.quill.off("text-change",this.onTextChange);var o=(new t).retain(this.hashIndex).delete(this.query.length+1);this.quill.updateContents(o,e.sources.USER),n&&(this.quill.insertEmbed(this.hashIndex,"placeholder",n,e.sources.USER),this.quill.setSelection(this.hashIndex+1,0,e.sources.SILENT)),this.quill.focus(),this.open=!1,this.quill.suggestsDialogOpen=!1,this.onClose&&this.onClose(n||null)}}]),n}()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.h=function(e,t){for(var n=arguments.length,o=Array(n>2?n-2:0),i=2;i<n;i++)o[i-2]=arguments[i];var r=document.createElement(e);return Object.keys(t).forEach(function(e){return r[e]=t[e]}),o.forEach(function(e){"string"==typeof e&&(e=document.createTextNode(e)),r.appendChild(e)}),r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=function e(t,n,o){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,o)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(o):void 0};t.default=function(e){var t=e.import("blots/inline"),n=function(e){function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,t),o(n,[{key:"format",value:function(e,t){"suggest"===e&&t?this.domNode.setAttribute("data-id",t):i(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"format",this).call(this,e,t)}},{key:"formats",value:function(){var e=i(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"formats",this).call(this);return e.suggest=n.formats(this.domNode),e}}],[{key:"create",value:function(e){var t=i(n.__proto__||Object.getPrototypeOf(n),"create",this).call(this);return t.dataset.id=e,t}},{key:"formats",value:function(e){return e.dataset.id}}]),n}();return n.blotName="suggest",n.tagName="SPAN",n.className="suggest",n}}]).default});
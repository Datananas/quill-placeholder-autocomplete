!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.QuillPlaceholderAutocomplete=e():t.QuillPlaceholderAutocomplete=e()}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){n(1),t.exports=n(2)},function(t,e){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&a.return&&a.return()}finally{if(r)throw o}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=l(n(3)),s=l(n(5)),a=n(7),u=l(n(8));function l(t){return t&&t.__esModule?t:{default:t}}e.default=function(t){var e=t.import("delta");return t.register("formats/suggest",(0,u.default)(t)),function(){function n(t,e){var i=e.onOpen,r=e.onClose,o=e.getPlaceholders,u=e.fetchPlaceholders,l=e.onFetchStarted,h=e.onFetchFinished,c=e.container,f=e.debounceTime,d=void 0===f?0:f,p=e.triggerKey,y=void 0===p?"#":p,g=e.endKey;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var v=this.update.bind(this);this.quill=t,this.onClose=r,this.onOpen=i,this.onFetchStarted=l,this.onFetchFinished=h,this.getPlaceholders=o,this.fetchPlaceholders=u,this.triggerKey=y,this.endKey=g,"string"==typeof c?this.container=this.quill.container.parentNode.querySelector(c):void 0===c?(this.container=(0,a.h)("ul",{}),this.quill.container.parentNode.appendChild(this.container)):this.container=c,this.container.classList.add("ql-autocomplete-menu","completions"),this.container.style.position="absolute",this.container.style.display="none",this.onSelectionChange=this.maybeUnfocus.bind(this),this.onTextChange=d?(0,s.default)(v,d):v,this.open=!1,this.quill.suggestsDialogOpen=!1,this.hashIndex=null,this.focusedButton=null,this.buttons=[],this.matchedPlaceholders=[],this.toolbarHeight=0,this.suggestAcceptDownHandler=function(t){if("Enter"===t.key||this.endKey&&t.key===this.endKey){var e=this.quill.getSelection().index;this.originalQuery=this.quill.getText(this.hashIndex+1,e-this.hashIndex-1),this.query=this.originalQuery.toLowerCase(),this.handleSuggestAccept(),t.preventDefault()}}.bind(this),t.suggestHandler=this.onHashKey.bind(this),this.initBindings()}return r(n,[{key:"initBindings",value:function(){var t=this,e=this.quill;e.root.addEventListener("keydown",function(n){n.defaultPrevented||n.key===t.triggerKey&&(t.toolbarHeight||(t.toolbarHeight=e.getModule("toolbar").container.offsetHeight),t.onHashKey(e.getSelection()),n.preventDefault())},!0),e.keyboard.addBinding({key:40,collapsed:!0,format:["suggest"]},this.handleArrow.bind(this)),e.keyboard.addBinding({key:27,collapsed:null,format:["suggest"]},this.handleEscape.bind(this))}},{key:"onHashKey",value:function(e){if(this.open)return!0;var n=e.index,i=e.length;e.length>0&&this.quill.deleteText(n,i,t.sources.USER),this.quill.insertText(n,this.triggerKey,"suggest","@@placeholder",t.sources.API);var r=this.quill.getBounds(n),o=this.toolbarHeight+2;this.quill.setSelection(n+1,t.sources.SILENT),this.hashIndex=n,this.container.style.left=r.left+"px",this.container.style.top=r.top+r.height+o+"px",this.open=!0,this.quill.suggestsDialogOpen=!0,this.quill.on("text-change",this.onTextChange),this.quill.once("selection-change",this.onSelectionChange),this.quill.root.addEventListener("keydown",this.suggestAcceptDownHandler),this.update(),this.onOpen&&this.onOpen()}},{key:"handleArrow",value:function(){if(!this.open)return!0;this.buttons[0].focus()}},{key:"handleSuggestAccept",value:function(){if(!this.open)return!0;this.close(this.matchedPlaceholders[0])}},{key:"handleEscape",value:function(){if(!this.open)return!0;this.close()}},{key:"emptyCompletionsContainer",value:function(){for(;this.container.firstChild;)this.container.removeChild(this.container.firstChild)}},{key:"update",value:function(){if(this.open){var t=this.quill.getSelection().index,e=this.getPlaceholders(),n=e.map(function(t){return t.label}),i=(0,o.default)(n,!1);this.hashIndex>=t?this.close(null):(this.originalQuery=this.quill.getText(this.hashIndex+1,t-this.hashIndex-1),this.query=this.originalQuery.toLowerCase(),this.fetchPlaceholders&&this.query.length?this.handleAsyncFetching(e,n,i).then(this.handleUpdateEnd.bind(this)):this.handleUpdateEnd({placeholders:e,labels:n,fs:i}))}}},{key:"handleUpdateEnd",value:function(t){var e=t.placeholders,n=t.labels,r=t.fs.get(this.query);r=r?r.map(function(t){return i(t,2)[1]}):n,this.matchedPlaceholders=e.filter(function(t){var e=t.label;return-1!==r.indexOf(e)}),this.renderCompletions(this.matchedPlaceholders)}},{key:"handleAsyncFetching",value:function(t,e,n){var i=this;return this.onFetchStarted&&this.onFetchStarted(this.query),this.fetchPlaceholders(this.query).then(function(r){return i.onFetchFinished&&i.onFetchFinished(r),r&&r.length&&r.forEach(function(i){-1===e.indexOf(i.label)&&(n.add(i.label),t.push(i),e.push(i.label))}),{placeholders:t,labels:e,fs:n}})}},{key:"maybeUnfocus",value:function(){this.container.querySelector("*:focus")||this.close(null)}},{key:"renderCompletions",value:function(t){var e=this;this.emptyCompletionsContainer();var n=Array(t.length);this.buttons=n;var i=new RegExp("^(.*)("+this.query+")(.*)$");t.forEach(function(t,r){var o=t.label,s=(o.match(i)||[null,o]).slice(1).map(function(t,e){return t.length?(0,a.h)("span",{className:1===e?"matched":"unmatched"},t):null}).filter(function(t){return t}),u=(0,a.h)("li",{},a.h.apply(void 0,["button",{type:"button"}].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(s))));e.container.appendChild(u),n[r]=u.firstChild,n[r].addEventListener("keydown",function(t,i){return function(r){"ArrowDown"===r.key||40===r.keyCode?(r.preventDefault(),n[Math.min(n.length-1,t+1)].focus()):"ArrowUp"===r.key||38===r.keyCode?(r.preventDefault(),n[Math.max(0,t-1)].focus()):"Enter"===r.key||13===r.keyCode||" "===r.key||32===r.keyCode||"Tab"===r.key||9===r.keyCode?(r.preventDefault(),e.close(i)):"Escape"!==r.key&&27!==r.keyCode||(r.preventDefault(),e.close())}}(r,t)),n[r].addEventListener("mousedown",function(){return e.close(t)}),n[r].addEventListener("focus",function(){return e.focusedButton=r}),n[r].addEventListener("unfocus",function(){return e.focusedButton=null})}),this.container.style.display="block"}},{key:"close",value:function(n){this.container.style.display="none",this.emptyCompletionsContainer(),this.quill.off("selection-change",this.onSelectionChange),this.quill.off("text-change",this.onTextChange),this.quill.root.removeEventListener("keydown",this.suggestKeydownHandler);var i=(new e).retain(this.hashIndex).delete(this.query.length+1);this.quill.updateContents(i,t.sources.USER),n&&(this.quill.insertEmbed(this.hashIndex,"placeholder",n,t.sources.USER),this.quill.setSelection(this.hashIndex+1,0,t.sources.SILENT)),this.quill.focus(),this.open=!1,this.quill.suggestsDialogOpen=!1,this.onClose&&this.onClose(n||null)}}]),n}()}},function(t,e,n){t.exports=n(4)},function(t,e){!function(){var e=function(t,e,n,i){var r={};t=t||[],r.gramSizeLower=n||2,r.gramSizeUpper=i||3,r.useLevenshtein="boolean"!=typeof e||e,r.exactSet={},r.matchDict={},r.items={};var o=function(t,e){if(null===t&&null===e)throw"Trying to compare two null values";if(null===t||null===e)return 0;var n=function(t,e){for(var n,i,r=[],o=0;o<=e.length;o++)for(var s=0;s<=t.length;s++)i=o&&s?t.charAt(s-1)===e.charAt(o-1)?n:Math.min(r[s],r[s-1],n)+1:o+s,n=r[s],r[s]=i;return r.pop()}(t=String(t),e=String(e));return t.length>e.length?1-n/t.length:1-n/e.length},s=/[^a-zA-Z0-9\u00C0-\u00FF, ]+/g,a=function(t,e){for(var n={},i=function(t,e){e=e||2;var n="-"+t.toLowerCase().replace(s,"")+"-",i=e-n.length,r=[];if(i>0)for(var o=0;o<i;++o)t+="-";for(o=0;o<n.length-e+1;++o)r.push(n.slice(o,o+e));return r}(t,e=e||2),r=0;r<i.length;++r)i[r]in n?n[i[r]]+=1:n[i[r]]=1;return n};r.get=function(t,e,n){void 0===n&&(n=.33);var i=this._get(t,n);return i||void 0===e?i:e},r._get=function(t,e){var n=this._normalizeStr(t),i=this.exactSet[n];if(i)return[[1,i]];for(var r=[],o=this.gramSizeUpper;o>=this.gramSizeLower;--o)if((r=this.__get(t,o,e))&&r.length>0)return r;return null},r.__get=function(t,e,n){var i,r,s,u,l=this._normalizeStr(t),h={},c=a(l,e),f=this.items[e],d=0;for(i in c)if(r=c[i],d+=Math.pow(r,2),i in this.matchDict)for(S=0;S<this.matchDict[i].length;++S)s=this.matchDict[i][S][0],u=this.matchDict[i][S][1],s in h?h[s]+=r*u:h[s]=r*u;if(function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}(h))return null;var p,y=Math.sqrt(d),g=[];for(var v in h)p=h[v],g.push([p/(y*f[v][0]),f[v][1]]);var m=function(t,e){return t[0]<e[0]?1:t[0]>e[0]?-1:0};if(g.sort(m),this.useLevenshtein){for(var b=[],x=Math.min(50,g.length),S=0;S<x;++S)b.push([o(g[S][1],l),g[S][1]]);(g=b).sort(m)}b=[];return g.forEach(function(t){t[0]>=n&&b.push([t[0],this.exactSet[t[1]]])}.bind(this)),b},r.add=function(t){if(this._normalizeStr(t)in this.exactSet)return!1;for(var e=this.gramSizeLower;e<this.gramSizeUpper+1;++e)this._add(t,e)},r._add=function(t,e){var n=this._normalizeStr(t),i=this.items[e]||[],r=i.length;i.push(0);var o,s,u=a(n,e),l=0;for(o in u)s=u[o],l+=Math.pow(s,2),o in this.matchDict?this.matchDict[o].push([r,s]):this.matchDict[o]=[[r,s]];var h=Math.sqrt(l);i[r]=[h,n],this.items[e]=i,this.exactSet[n]=t},r._normalizeStr=function(t){if("[object String]"!==Object.prototype.toString.call(t))throw"Must use a string as argument to FuzzySet functions";return t.toLowerCase()},r.length=function(){var t,e=0;for(t in this.exactSet)this.exactSet.hasOwnProperty(t)&&(e+=1);return e},r.isEmpty=function(){for(var t in this.exactSet)if(this.exactSet.hasOwnProperty(t))return!1;return!0},r.values=function(){var t,e=[];for(t in this.exactSet)this.exactSet.hasOwnProperty(t)&&e.push(this.exactSet[t]);return e};for(var u=r.gramSizeLower;u<r.gramSizeUpper+1;++u)r.items[u]=[];for(u=0;u<t.length;++u)r.add(t[u]);return r};void 0!==t&&t.exports?(t.exports=e,this.FuzzySet=e):this.FuzzySet=e}()},function(t,e,n){(function(e){var n="Expected a function",i=NaN,r="[object Symbol]",o=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,u=/^0o[0-7]+$/i,l=parseInt,h="object"==typeof e&&e&&e.Object===Object&&e,c="object"==typeof self&&self&&self.Object===Object&&self,f=h||c||Function("return this")(),d=Object.prototype.toString,p=Math.max,y=Math.min,g=function(){return f.Date.now()};function v(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function m(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&d.call(t)==r}(t))return i;if(v(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=v(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(o,"");var n=a.test(t);return n||u.test(t)?l(t.slice(2),n?2:8):s.test(t)?i:+t}t.exports=function(t,e,i){var r,o,s,a,u,l,h=0,c=!1,f=!1,d=!0;if("function"!=typeof t)throw new TypeError(n);function b(e){var n=r,i=o;return r=o=void 0,h=e,a=t.apply(i,n)}function x(t){var n=t-l;return void 0===l||n>=e||n<0||f&&t-h>=s}function S(){var t=g();if(x(t))return w(t);u=setTimeout(S,function(t){var n=e-(t-l);return f?y(n,s-(t-h)):n}(t))}function w(t){return u=void 0,d&&r?b(t):(r=o=void 0,a)}function O(){var t=g(),n=x(t);if(r=arguments,o=this,l=t,n){if(void 0===u)return function(t){return h=t,u=setTimeout(S,e),c?b(t):a}(l);if(f)return u=setTimeout(S,e),b(l)}return void 0===u&&(u=setTimeout(S,e)),a}return e=m(e)||0,v(i)&&(c=!!i.leading,s=(f="maxWait"in i)?p(m(i.maxWait)||0,e):s,d="trailing"in i?!!i.trailing:d),O.cancel=function(){void 0!==u&&clearTimeout(u),h=0,r=l=o=u=void 0},O.flush=function(){return void 0===u?a:w(g())},O}}).call(e,n(6))},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.h=function(t,e){for(var n=arguments.length,i=Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];var o=document.createElement(t);return Object.keys(e).forEach(function(t){return o[t]=e[t]}),i.forEach(function(t){"string"==typeof t&&(t=document.createTextNode(t)),o.appendChild(t)}),o}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var s=r.get;return void 0!==s?s.call(i):void 0};e.default=function(t){var e=t.import("blots/inline"),n=function(t){function n(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,e),i(n,[{key:"format",value:function(t,e){"suggest"===t&&e?this.domNode.setAttribute("data-id",e):r(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"format",this).call(this,t,e)}},{key:"formats",value:function(){var t=r(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"formats",this).call(this);return t.suggest=n.formats(this.domNode),t}}],[{key:"create",value:function(t){var e=r(n.__proto__||Object.getPrototypeOf(n),"create",this).call(this);return e.dataset.id=t,e}},{key:"formats",value:function(t){return t.dataset.id}}]),n}();return n.blotName="suggest",n.tagName="SPAN",n.className="suggest",n}}]).default});